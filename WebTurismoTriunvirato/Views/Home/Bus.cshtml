@model IEnumerable<Web_Turismo_Triunvirato.Models.BusPromotion>  
@using System.Globalization;
@using Web_Turismo_Triunvirato.Models.ViewModels

@{
    ViewData["Title"] = "Autobuses";
}

<head>
    <link rel="stylesheet" href="~/css/RutaAtlantica.css" />
    <link rel="stylesheet" href="~/css/BusAnimation.css" />
    <link rel="stylesheet" href="~/css/vuelos.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra de boletos</title>
</head>

<div class="header-container">
    <img src="~/img/RutaAtlantica/Bus_Header.gif" alt="Bus Header" class="bus-header-image" />
    <div class="overlay-text">
        <h1 class="animated-heading">Busca tu próximo destino</h1>
        <p class="signature-text">Turismo Triunvirato</p>
    </div>
</div>

<script src="https://rutatlantica.com.ar/js/ruta-widget.js" data-sellerid="d95be34d-bb0f-45c8-b7ac-b80178814006" data-theme="default"></script>


<div class="flight-search-container">
    <h4>Encuentra tu Autobus ideal</h4>
    <div class="flight-search-options">
        <label>
            <input type="radio" name="flight-type" value="round-trip" checked> Ida y Vuelta
        </label>
        <label>
            <input type="radio" name="flight-type" value="one-way"> Solo Ida
        </label>
        <label>
            <input type="radio" name="flight-type" value="multi-destination"> Multidestino
        </label>
    </div>
    <div class="flight-search-inputs">
        <div class="input-group">
            <label for="origin">Origen</label>
            <input type="text" id="origin" placeholder="Ingresa ciudad, país o región">
        </div>
        <div class="input-group">
            <label for="destination">Destino</label>
            <input type="text" id="destination" placeholder="¿Adónde vas?">
        </div>
        <div class="input-group">
            <label for="departure-date">Fecha de Ida</label>
            <input type="date" id="departure-date">
        </div>
        <div class="input-group">
            <label for="return-date">Fecha de Vuelta</label>
            <input type="date" id="return-date">
        </div>
        <div class="input-group">
            <label for="passengers">Pasajeros, Clase</label>
            <select id="passengers">
                <option value="1">1 pasajero, Económica</option>
                <option value="2">2 pasajeros, Económica</option>
            </select>
        </div>
        <button class="search-button">Buscar</button>
    </div>
    <div class="more-options">
        <label>
            <input type="checkbox"> Ver fechas más baratas
        </label>
    </div>
</div>


<section class="destinations-section">
    <h4 style="color:darkblue">Destinos Populares</h4> @* Título actualizado *@
    <div class="destinations-grid">
        @if (Model != null && Model.Any())
        {

            @foreach (var promotion in Model)
            {
                // --- 1. IMPLEMENTACIÓN DEL MAPEO ---
                // Creamos el ViewModel que el modal espera (ModalContratoViewModel)
                // a partir de los datos del modelo actual (promotion - BusPromotion).
                var modalVM = new ModalContratoViewModel
                {
                    IdItem = promotion.Id,
                    Title = $"Bus a {promotion.DestinationName}", // Título
                    ImageUrl = Url.Content(promotion.ImageUrl),
                    Price = promotion.OfferPrice,

                    // Descripción larga para el cuerpo del modal
                    LongDescription = $"Compañía: {promotion.BusCompanyName}. Categoría: {promotion.Category}. Salida: {promotion.StartDate:dd/MM/yyyy}. {promotion.Description}",

                    // Texto de detalle corto para la parte superior del modal
                    DetailText = $"Desde {promotion.OriginName} | Categoría: {promotion.Category}",

                    // Datos para el formulario de Mail/WhatsApp
                    RenderedWhatsappMessage = promotion.RenderedWhatsappMessage,
                    // (Otros campos como WhatsappNumber si aplican)
                };

                var modalTargetId = $"packageModal-{modalVM.IdItem}"; // ID ÚNICO

                <div class="destination-card">
                    @* BADGES *@
                    @if (promotion.IsHotWeek)
                    {
                        <span class="hot-week-badge">HOT WEEK</span>
                    }
                    else if (promotion.DiscountPercentage > 0)
                    {
                        <span class="discount-badge">¡@promotion.DiscountPercentage.ToString("F0")% OFF!</span>
                    }

                    @* CONTENEDOR DE IMAGEN (Nuevo diseño, sin <a> principal) *@
                    <div class="image-container">
                        <img src="@Url.Content(promotion.ImageUrl)" alt="@promotion.DestinationName">
                    </div>

                    @* SECCIÓN DE INFORMACIÓN VISIBLE *@
                    <div class="destination-info">

                        <h3 class="mb-1">@promotion.DestinationName</h3>

                        <p class="price">
                            @promotion.OfferPrice.ToString("C0", new System.Globalization.CultureInfo("es-AR"))
                        </p>

                        @* Descripción corta y origen *@
                        <p class="details-text">
                            Desde: **@promotion.OriginName** | @promotion.BusCompanyName
                        </p>

                        @* BOTÓN DE ACCIÓN: Abrir el Modal *@
                        <button type="button"
                                class="ver-detalles-button"
                                data-bs-toggle="modal"
                                data-bs-target="#@modalTargetId">
                            Ver Detalles
                        </button>
                    </div>
                </div>

                @* --- LLAMADA A LA VISTA PARCIAL (con el ViewModel Mapeado) --- *@
                @await Html.PartialAsync("_MasInformacionGenerico", modalVM)
            }
        }
        else
        {
            <p class="col-12 alert alert-info text-center">No hay destinos populares de Autobuses disponibles en este momento.</p>

        }
    </div>
</section>

@* Si aún usas el viewModel DestinationsViewModel en algún otro lugar de la vista
   y quieres mantenerlo por alguna razón, podrías adaptarlo.
   Pero lo ideal es que la vista reciba directamente el modelo que va a renderizar.
   En este caso, IEnumerable<Promotion> es lo más directo.
*@