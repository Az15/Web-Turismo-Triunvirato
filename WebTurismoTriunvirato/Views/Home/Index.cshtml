@using Web_Turismo_Triunvirato.Models.ViewModels
@using System.Globalization; @* Necesario para CultureInfo para el formato de moneda *@

@model View_Index_Collection 
@* <--- ¡IMPORTANTE! Declarar el tipo de modelo esperado por la vista *@

@{
    ViewData["Title"] = "Bienvenido";
}

<head>
    <link rel="stylesheet" href="~/css/carrousel.css" />
    <link rel="stylesheet" href="~/css/package.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

@* Contenedor Principal del Carrusel *@
<div id="mainCarousel" class="carousel slide mt-2" data-bs-ride="carousel">
    <div class="carousel-inner">
        @{
            int carouselItemCount = 0; // Para controlar la clase 'active' del primer elemento del carrusel
        }

        @* Iterar sobre los elementos del carrusel desde el modelo *@
        @if (Model.DestinationCarrousel != null && Model.DestinationCarrousel.Any())
{
            @foreach (var item in Model.DestinationCarrousel)
            {
                // 1. Mapeo al ModalContratoViewModel
                var modalData = new Web_Turismo_Triunvirato.Models.ViewModels.ModalContratoViewModel
                {
                    IdItem = item.Id ?? 0, // Usar 0 si el ID es nulo
                    Title = item.Title ?? "Destino en Carrusel",
                    ImageUrl = item.ImageUrl,            
                    // ATENCIÓN: Estos campos NO EXISTEN en View_Index_DestinationCarouselItem.
                    // Los llenamos con valores por defecto para que el modal funcione.
                    // **RECOMENDACIÓN:** Si este destino tiene un precio, agrégalo al modelo del carrusel.
                    Price = 0.00M,
                    // --- AGREGADO: Serialización para el carrusel ---
                    PackageDetailsSerialized = $"Consulta desde Carrusel: {item.Title} | ID: {item.Id}",
                    DetailText = "¡Consulta por este gran destino!", 
                    LongDescription = item.Title ?? "Consulta por disponibilidad, precio y fechas.",

                    RenderedWhatsappMessage = item.RenderedWhatsappMessage,
                };
                var modalTargetId = $"packageModal-{modalData.IdItem}-carousel"; // ID único para evitar conflicto
        
                <div class="carousel-item @(carouselItemCount == 0 ? "active" : "")">
                    <img src="@item.ImageUrl" class="d-block w-100" alt="@item.AltText">
                    <div class="carousel-caption d-flex flex-column justify-content-end h-100">
                        <h5>@item.Title</h5>
                
@*                         <p>
                            <button type="button"
                                    class="btn btn-primary btn-sm w-100"
                                    data-bs-toggle="modal"
                                    data-bs-target="#@modalTargetId">
                                Ver más
                            </button>
                        </p> *@

                    </div>
                </div>

                carouselItemCount++; // Ya que estás dentro del @foreach
@*                 @Html.Partial("_MasInformacionGenerico", modalData)     *@ 
                
                        
                    
            }
        }
        else
        {
            @* Contenido de respaldo si el carrusel está vacío (opcional) *@
            <div class="carousel-item active">
                <img src="~/img/default-carousel-placeholder.jpg" class="d-block w-100" alt="No hay destinos disponibles">
                <div class="carousel-caption d-flex flex-column justify-content-end h-100">
                    <h5>No hay destinos disponibles en este momento.</h5>
                    <p><a href="/Contacto">Contáctanos para más información</a></p>
                </div>
            </div>
        }
    </div>

    @* Controles del Carrusel (flechas) *@
    <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>
</div>

@* Sección de "Paquetes más vendidos" *@
<div class="container mt-4">
    <h3>Paquetes más vendidos</h3>
    <div class="row flex-nowrap overflow-auto mt-4">

        @if (Model.PopularDestinations != null && Model.PopularDestinations.Any())
        {
            @* Usamos las clases destacadas para el layout y scroll *@
            <div class="destacados-horizontal">
                <div class="destacados-row">
                    @foreach (var item in Model.PopularDestinations)
                    {
                        // Mapeo (se mantiene igual)
                        var modalData = new ModalContratoViewModel
                        {
                            IdItem = item.Id,
                            Title = item.Title,
                            ImageUrl = item.PictureDestiny,
                            LongDescription = item.Title,
                            PackageDetailsSerialized = $"PAQUETE POPULAR: {item.Title} | Tipo: {item.TripType} | Origen: {item.From} | Precio: {item.Price:C}",
                            Price = item.Price,
                            DetailText = $"{item.TripType} | Desde {item.From}",
                            RenderedWhatsappMessage = item.RenderedWhatsappMessage,
                        };
                        var modalTargetId = $"packageModal-{modalData.IdItem}";

                        @* CLAVE: La tarjeta ahora es VERTICAL *@
                        <div class="card rounded-3 shadow-sm">

                            @* Imagen: Cambiamos a card-img-top para formato vertical *@
                            <img src="@item.PictureDestiny" class="card-img-left" alt="@item.Title">

                            @* Cuerpo: Contiene el texto y el botón *@
                            <div class="card-body">
                                <div>
                                    @* Subtítulo (Ej: IDA Y VUELTA) *@
                                    @if (!string.IsNullOrEmpty(item.TripType))
                                    {
                                        <h6 class="card-subtitle">@item.TripType</h6>
                                    }

                                    @* Título (Ej: Cataratas de Iguazú) *@
                                    <h5 class="card-title">@item.Title</h5>

                                    @* Precio y Origen *@
                                    <p class="card-text">
                                        <span class="fw-bold">@item.Price.ToString("C", new CultureInfo("es-AR"))</span><br>
                                        Desde @item.From
                                    </p>
                                </div>

                                @* Botón: Con estilo azul y pegado al final *@
                                <button type="button"
                                        class="destacados-button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#@modalTargetId">
                                    Ver más
                                </button>

                                @* Inyectamos el modal *@
                                @await Html.PartialAsync("_MasInformacionGenerico", modalData)
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="col-12 text-center text-muted">
                <p>No hay paquetes más vendidos disponibles en este momento.</p>
            </div>
        }

    </div>
</div>

